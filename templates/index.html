<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Lista de Tareas</title>
  <link rel="stylesheet" href="static/main.css">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-ZhjjiYBzTePrKLEnMK5lWvzuG9gIzCJ6CEwex6B/6JgIU6tuL2oqIYGdJ8HPb8j2" crossorigin="anonymous">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.1.3/js/bootstrap.bundle.min.js"></script>

</head>
<body>
<br>

    <a  onclick="openWindow('/form_nueva_tarea', 500, 300)">
    <button type="button">
    <i class="bi bi-file-earmark-plus custom-icon"></i>
    </button>
    </a>
    <script>
    function openWindow(url, width, height) {
      var left = (screen.width - width) / 2;
      var top = (screen.height - height) / 2;
      window.open(url, '', 'toolbar=no, location=no, directories=no, status=no, menubar=no, scrollbars=no, resizable=no, copyhistory=no, width=' + width + ', height=' + height + ', top=' + top + ', left=' + left);
    }
    </script>

<br>
<div class="d-flex flex-column">
<div class="flex-container">
  <h2 class="titulo">Tareas de hoy {{hoy.strftime('%d/%m/%Y')}}</h2>
  {% for t in lista_hoy %}
  <div class="{% if t.realizada == False %}post-it{% elif t.realizada %}realizada{% endif %}">
    <h2>{{t.titulo}}</h2>
    <p class="contenido">{{t.contenido}}</p>
    <!--<fecha>{{t.fecha_alerta.strftime('%d/%m/%Y')}}</fecha>-->
    <form action="/posponer/{{ t.id }}" method="POST" class="d-inline-flex align-items-center" onsubmit="return posponer(event, {{ t.id }})">
      <input type="hidden" name="id" value="{{ t.id }}">
      <input type="hidden" name="clase" value="Tarea">
      <button type="submit"><i class="bi bi-pencil custom-icon2"></i></button>
    </form>
    <form action="/borrar_tarea/{{ t.id }}" method="POST" class="d-inline-flex align-items-center" onsubmit="return confirm('¿Estás seguro de que quieres borrar esta tarea?');">
      <input type="hidden" name="id" value="{{ t.id }}">
      <input type="hidden" name="clase" value="Tarea">
      <button type="submit"><i class="bi bi-trash custom-icon2"></i></button>
    </form>
    <form action="/realizar_tarea/{{ t.id }}" method="POST" class="d-inline-flex align-items-center">
      <input type="hidden" name="id" value="{{ t.id }}">
      <input type="hidden" name="clase" value="Tarea">
      <button type="submit"><i class="bi bi-check2-square custom-icon2"></i></button>
    </form>
  </div>
  {% endfor %}
</div>
    <div class="flex-container2">
  <h2 class="titulo2">Próximas</h2>
  {% for t in lista_proxima %}
  <div class="post-it2">
    <h2>{{t.titulo}}</h2>
    <p class="contenido">{{t.contenido}}</p>
    <fecha>{{t.fecha_alerta.strftime('%d/%m/%Y')}}</fecha>
    <form action="/posponer/{{ t.id }}" method="POST" class="d-inline-flex align-items-center" onsubmit="return posponer(event, {{ t.id }})">
      <input type="hidden" name="id" value="{{ t.id }}">
      <input type="hidden" name="clase" value="Tarea">
      <button type="submit"><i class="bi bi-pencil custom-icon2"></i></button>
    </form>
    <form action="/borrar_tarea/{{ t.id }}" method="POST" class="d-inline-flex align-items-center" onsubmit="return confirm('¿Estás seguro de que quieres borrar esta tarea?');">
      <input type="hidden" name="id" value="{{ t.id }}">
      <input type="hidden" name="clase" value="Tarea">
      <button type="submit"><i class="bi bi-trash custom-icon2"></i></button>
    </form>
    <form action="/realizar_tarea/{{ t.id }}" method="POST" class="d-inline-flex align-items-center">
      <input type="hidden" name="id" value="{{ t.id }}">
      <input type="hidden" name="clase" value="Tarea">
      <button type="submit"><i class="bi bi-check2-square custom-icon2"></i></button>
    </form>
  </div>
  {% endfor %}
</div>
</div>

<script>
  function posponer(event, tareaId) {
    event.preventDefault(); // Prevenir el envío del formulario normalmente

    // Solicitar una nueva fecha al usuario
    var nuevaFecha = prompt("Ingrese la nueva fecha para la tarea (DD-MM-AAAA):");

    // Verificar si el usuario ingresó una fecha
    if (nuevaFecha !== null && nuevaFecha !== "") {
      // Crear un formulario oculto y enviar la nueva fecha al servidor
      var form = document.createElement('form');
      form.setAttribute('method', 'POST');
      form.setAttribute('action', '/posponer/' + tareaId);
      form.innerHTML = '<input type="hidden" name="nueva_fecha" value="' + nuevaFecha + '">';
      document.body.appendChild(form);
      form.submit();
    }
  }
</script>

</body>
</html>
